# 工作日志改进方案

> **版本**：v1.1
> **创建日期**：2026-02-01
> **状态**：执行中

---

## 📊 问题分析

### 当前工作日志的问题

| 问题 | 影响 | 优先级 |
|------|------|--------|
| 只记录完成的工作 | 无法跟踪进行中的任务 | 🔴 高 |
| 没有状态管理 | 重启后不知道哪些任务进行中 | 🔴 高 |
| 缺少优先级排序 | 不知道先做哪个 | 🟡 中 |
| 没有阻塞原因记录 | 不知道任务为什么卡住 | 🟡 中 |
| 没有自动触发机制 | AI 需要判断何时记录 | 🟢 低 |

---

## 🎯 设计目标

1. **状态可见**：一眼看出哪些任务在进行中、哪些被阻塞
2. **快速恢复**：新会话能快速了解"还有什么没做完"
3. **优先级清晰**：知道下一步应该做什么
4. **轻量级**：不增加太多负担，只记录有意义的信息

---

## 📁 文件结构

```
docs/
├── WORK-LOG.md           ← 完成的工作归档（只追加）
├── TASKS.md              ← 任务看板（新增）✅
│   ├── 🔴 待开始
│   ├── 🟡 进行中
│   ├── 🟠 等待条件
│   └── ✅ 已完成（最近5条）
└── WORK-LOG-REDESIGN.md  ← 本方案文档
```

---

## 🔄 任务状态流转

```
┌──────────────┐    完成工作    ┌──────────────┐
│   🔴 待开始   │ ──────────────>│    ✅ 已完成  │
│              │                │              │
└──────┬───────┘                └──────┬───────┘
       │                               │
       │ 开始工作                         │ 归档到
       v                               │ WORK-LOG.md
┌──────────────┐                   记录到
│   🟡 进行中   │ ──────┐             │
│              │      │             │
└──────┬───────┘      │             │
       │              │ 条件不足     │
       v              v             │
┌──────────────┐    需要条件     │
│   🟠 等待条件 │ ──────────────┘
│              │
└───────────────┘
```

---

## 📋 任务条目模板

### 完整模板

```markdown
### [状态] P[0-2] 任务名称

**创建时间**：YYYY-MM-DD HH:MM
**最后更新**：YYYY-MM-DD HH:MM
**预计完成**：YYYY-MM-DD（可选）

**描述**：
[任务详细描述，1-3 行]

**子任务**：
- [ ] 子任务 1
- [x] 子任务 2（已完成）
- [ ] 子任务 3

**依赖**：
- 需要完成：[其他任务]
- 需要资源：[API Key/文档/用户反馈]

**阻塞原因**（如果是 Blocked 状态）：
- 具体描述阻塞原因

**进度**：
- 完成度：XX%
- 当前步骤：[具体步骤描述]

**相关文件**：
- `path/to/file1`
- `path/to/file2`

**相关文档**：
- `docs/XXX.md`
```

### 简化模板（小任务）

```markdown
- [ ] P1: 快速任务描述
```

---

## 📅 短期方案（本周完成）

### 1. 创建 TASKS.md ✅ 已完成
- [x] 创建任务看板文件
- [x] 定义 4 种状态
- [x] 创建任务模板
- [x] 添加现有待办任务

### 2. 更新 workflow-recovery.md ✅ 已完成
- [x] 添加记录阈值
- [x] 明确不需要记录的情况
- [x] 添加任务状态变更规则

### 3. 更新 README.md 约束清单
- [x] 引入 TASKS.md 作为核心文档
- [ ] 说明 WORK-LOG.md 和 TASKS.md 的关系

### 4. 会话恢复流程优化
- [ ] 启动时优先读取 TASKS.md（最后 20 行）
- [ ] 显示"待开始"和"进行中"的任务
- [ ] 询问用户是否继续某个任务

### 5. Hookify 自动提醒 ✅ 已完成
- [x] 创建会话结束前检查规则
- [x] 创建 Git commit 前检查规则
- [x] 创建任务完成提醒规则

**规则文件**：
```
.claude/
├── hookify.task-check-session-end.local.md    ← 会话结束前检查
├── hookify.task-check-git-commit.local.md     ← Git commit 前检查
└── hookify.task-completion-reminder.local.md  ← 任务完成提醒
```

**禁用方法**：将文件中 `enabled: true` 改为 `enabled: false`

---

## 🚀 长期方案（本月内完成）

### 1. Git Hook 自动化
- [ ] 配置 `pre-commit` Hook 提醒更新 TASKS.md
- [ ] 配置 `commit-msg` Hook 自动记录到 TASKS.md

### 2. AI 约束优化
- [ ] 更新所有约束文档
- [ ] 添加 TASKS.md 读取规则
- [ ] 添加任务状态变更规则

### 3. 工具集成
- [ ] 创建 `/tasks` 命令快速查看任务
- [ ] 创建 `/task <id>` 命令更新任务状态
- [ ] 创建 `/done` 命令标记任务完成

### 4. 文档同步
- [ ] 任务完成时自动更新 WORK-LOG.md
- [ ] 每日结束时生成进度报告

---

## 💡 使用示例

### 场景 1：新会话启动

```
[AI 自动执行]
读取 TASKS.md 后显示：

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 当前任务状态

🟡 进行中 (1 个任务)
  [ ] P0: Pre-commit Hook 验证
     进度: 测试编写中 (60%)

🔴 待开始 (2 个任务)
  [ ] P0: GitHub MCP 功能验证
  [ ] P1: Memory MCP 功能验证

🟠 等待条件 (1 个任务)
  [ ] P1: GitHub Actions CI/CD 配置
     └─ 阻塞: 需要测试流程稳定

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

是否继续某个任务？
输入任务编号或 "继续 [任务名]"
```

### 场景 2：创建新任务

```
[用户]
"添加一个任务：配置 Sentry 错误监控"

[AI 自动执行]
1. 在 TASKS.md 中添加：
   ### 🔴 待开始
   ### [ ] P2: Sentry 错误监控配置
   **创建时间**：2026-02-01 15:30
   **描述**：配置 Sentry 集成
   **依赖**：需要 Sentry API Key

2. 返回：任务已添加，优先级 P2
```

### 场景 3：任务状态变更

```
[用户]
"开始做 GitHub MCP 验证"

[AI 自动执行]
1. 将任务从 🔴 待开始 移到 🟡 进行中
2. 添加进度：当前步骤 - 重启 Claude Code
3. 在状态变更日志中记录
```

---

## 📊 验证标准

| 标准 | 验证方式 |
|------|----------|
| 新会话能识别未完成任务 | 重启 Claude Code 测试 |
| 任务状态流转正确 | 手动测试各状态变更 |
| WORK-LOG.md 正确归档 | 完成任务后检查 |
| 约束文档完整 | 检查所有相关文档 |

---

## 🔗 相关文档

- **任务看板**：`docs/TASKS.md`
- **工作日志**：`docs/WORK-LOG.md`
- **约束索引**：`constraints/README.md`
- **工作流规则**：`constraints/workflow-recovery.md`

---

## ✅ 审批清单

请确认以下方案是否可行：

- [ ] 文件结构合理
- [ ] 状态流转清晰
- [ ] 记录阈值明确
- [ ] 短期方案可行
- [ ] 长期方案有价值

请输入 "确认" 开始执行，或提出修改建议。
