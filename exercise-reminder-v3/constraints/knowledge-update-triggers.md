# 知识库更新触发规则

> **项目**：exercise-reminder-v3
> **版本**：v1.0
> **创建日期**：2026-01-30
> **适用范围**：所有 AI Agent 会话

---

## 🎯 目的

确保项目经验和知识得到及时沉淀，避免经验流失和重复踩坑。

---

## 📌 核心原则

**"完成工作 ≠ 完成任务"**

```
完成工作后：
1. 必须询问 PM 是否更新知识库
2. 得到确认后才算真正完成
3. 更新知识库后才能继续下一步
```

---

## 📋 强制触发规则

### 规则 1：Bug 修复后必须询问

**触发条件**：
- ✅ 修复了任何 bug
- ✅ 解决了技术问题
- ✅ 排查并修复了错误

**必须执行的对话**：

```
[AI 自动执行]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🐛 Bug 已修复！

问题描述：[简要描述 bug]
解决方案：[简要描述解决方案]

是否需要我更新 docs/BUG-QUESTION-LOG.md？
这将记录：
• 问题描述
• 排查过程
• 解决方案
• 经验教训

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

请回答：是 / 否 / 稍后
```

**PM 回答后**：
- **"是"**：立即更新 `BUG-QUESTION-LOG.md`，然后继续下一步
- **"否"**：跳过更新，继续下一步
- **"稍后"**：添加到待办列表，继续下一步

---

### 规则 2：首次使用新工具后必须询问

**触发条件**：
- ✅ 首次使用新的 Skill
- ✅ 首次使用新的 MCP 工具
- ✅ 发现了工具的新用法

**必须执行的对话**：

```
[AI 自动执行]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🛠️ 首次使用工具：[工具名称]

使用场景：[描述使用场景]
实际效果：[描述效果]
对比分析：[与其他工具对比]

是否需要我记录到 docs/SKILLS-MCP-GUIDE.md？
这将记录：
• 使用场景
• 实际效果
• 对比分析
• 推荐指数

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

请回答：是 / 否 / 稍后
```

**PM 回答后**：
- **"是"**：立即更新 `SKILLS-MCP-GUIDE.md`，然后继续下一步
- **"否"**：跳过更新，继续下一步
- **"稍后"**：添加到待办列表，继续下一步

---

### 规则 3：工作流程改进后必须询问

**触发条件**：
- ✅ 改进了开发流程
- ✅ 发现了更好的工作方式
- ✅ 优化了 AI 使用模式

**必须执行的对话**：

```
[AI 自动执行]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔄 工作流程已改进！

改进内容：[描述改进内容]
改进原因：[描述为什么改进]
效果对比：[描述改进前后对比]

是否需要我更新 docs/WORKFLOW-EVOLUTION.md？
这将记录：
• 改进原因
• 改进方案
• 效果对比
• 指标变化

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

请回答：是 / 否 / 稍后
```

**PM 回答后**：
- **"是"**：立即更新 `WORKFLOW-EVOLUTION.md`，然后继续下一步
- **"否"**：跳过更新，继续下一步
- **"稍后"**：添加到待办列表，继续下一步

---

### 规则 4：技术决策后必须询问

**触发条件**：
- ✅ 做出了技术选型决策
- ✅ 确定了架构设计方案
- ✅ 选择了特定技术栈

**必须执行的对话**：

```
[AI 自动执行]
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
💡 技术决策已做出！

决策内容：[描述决策内容]
决策依据：[描述为什么这样选]
考虑方案：[描述考虑过的其他方案]

是否需要我记录到 docs/KNOWLEDGE-BASE.md？
这将记录：
• 决策内容
• 决策依据
• 考虑方案
• 最终选择

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

请回答：是 / 否 / 稍后
```

**PM 回答后**：
- **"是"**：立即更新 `KNOWLEDGE-BASE.md`，然后继续下一步
- **"否"**：跳过更新，继续下一步
- **"稍后"**：添加到待办列表，继续下一步

---

## 🔀 执行流程

### 标准流程

```
[完成工作]
    ↓
[AI 自动检查触发条件]
    ↓
[匹配到规则？]
    ├─ 是 → [询问 PM 是否更新知识库]
    │         ├─ "是" → [更新知识库] → [继续下一步]
    │         ├─ "否" → [跳过更新] → [继续下一步]
    │         └─ "稍后" → [添加待办] → [继续下一步]
    │
    └─ 否 → [继续下一步]
```

### 待办列表管理

当 PM 回答"稍后"时，添加到待办列表：

```markdown
## 📝 知识库更新待办

- [ ] 更新 BUG-QUESTION-LOG.md - [Bug 描述]
- [ ] 更新 SKILLS-MCP-GUIDE.md - [工具名称]
- [ ] 更新 WORKFLOW-EVOLUTION.md - [改进内容]
- [ ] 更新 KNOWLEDGE-BASE.md - [决策内容]
```

待办事项需要在以下时机处理：
- 完成当前任务后
- 会话结束前
- PM 要求更新时

---

## 🎯 问答格式规范

### AI 询问格式

```markdown
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📌 [触发规则图标] [触发标题]

[上下文信息]

是否需要我更新 [文档路径]？
这将记录：
• [要点 1]
• [要点 2]
• [要点 3]

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

请回答：是 / 否 / 稍后
```

### PM 回答格式

**直接回答**：
```
是
```

**带条件回答**：
```
是，但只记录关键部分，细节可以略过
```

**稍后回答**：
```
稍后，完成当前功能后再处理
```

**否定回答**：
```
否，这个是临时方案，不需要记录
```

---

## 📊 文档映射表

| 触发条件 | 询问模板 | 更新文档 | 图标 |
|----------|----------|----------|------|
| Bug 修复 | `🐛 Bug 已修复！` | `BUG-QUESTION-LOG.md` | 🐛 |
| 新工具 | `🛠️ 首次使用工具！` | `SKILLS-MCP-GUIDE.md` | 🛠️ |
| 流程改进 | `🔄 工作流程已改进！` | `WORKFLOW-EVOLUTION.md` | 🔄 |
| 技术决策 | `💡 技术决策已做出！` | `KNOWLEDGE-BASE.md` | 💡 |

---

## ✅ 强制执行检查清单

在标记任务为"完成"前，必须确认：

- [ ] 已检查是否触发任何规则
- [ ] 如已触发，已询问 PM 是否更新知识库
- [ ] 如 PM 回答"是"，已完成知识库更新
- [ ] 如 PM 回答"稍后"，已添加到待办列表

**只有满足以上所有条件后，才能标记任务为"完成"**

---

## 🔔 提醒机制

### AI 自动检测

AI 在以下时刻自动检测触发条件：
1. 完成一个任务后
2. 修复一个 bug 后
3. 使用新工具后
4. 做出决策后

### 自动提示

如果 AI 检测到触发条件但没有询问 PM：

```
⚠️ **警告**：检测到触发规则但未询问 PM！

触发的规则：[规则名称]
应该询问的问题：[询问模板]

请立即询问 PM 是否更新知识库！
```

---

## 📝 更新记录

| 日期 | 触发规则 | 更新内容 | PM 回答 |
|------|----------|----------|--------|
| 2026-01-30 | 规则 1-4 | 创建本规则文档 | - |

---

## 🔗 相关文档

- **工作日志**：`docs/WORK-LOG.md`
- **知识库**：`docs/KNOWLEDGE-BASE.md`
- **Bug 日志**：`docs/BUG-QUESTION-LOG.md`
- **工具手册**：`docs/SKILLS-MCP-GUIDE.md`
- **演进历史**：`docs/WORKFLOW-EVOLUTION.md`
- **工作流恢复规则**：`constraints/workflow-recovery.md`

---

> ⚠️ **重要提示**：这些规则是强制性的，不是可选项！
>
> 每次触发条件满足时，AI Agent **必须**询问 PM 是否更新知识库。
>
> 只有在 PM 回答后（无论是"是"、"否"还是"稍后"），才能继续下一步工作。
