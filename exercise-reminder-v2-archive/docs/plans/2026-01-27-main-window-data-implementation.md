# ä¸»çª—å£æ•°æ®å®ç°è®¾è®¡

**æ—¥æœŸ**: 2026-01-27
**ç›®æ ‡**: å®ç°ä¸»çª—å£çš„æ•°æ®åŠ è½½å’Œåˆ·æ–°åŠŸèƒ½

---

## æ¶æ„è®¾è®¡

```
MainWindow
    â†“
repositories (ActivityRepository, SettingRepository)
    â†“
Database (SQLite via Peewee)
```

**æ›´æ–°æœºåˆ¶**:
- å®šæ—¶å™¨æ¯ 30 ç§’è‡ªåŠ¨åˆ·æ–°
- `refresh_data()` æ–¹æ³•ä»æ•°æ®åº“è·å–æœ€æ–°æ•°æ®å¹¶æ›´æ–° UI

---

## æ¨¡å— 1: ä»Šæ—¥ç›®æ ‡è¿›åº¦

**æ•°æ®æ¥æº**:
- `ActivityRepository.get_calories_by_date(date.today())` - ä»Šæ—¥çƒ­é‡
- `SettingRepository.get_int("daily_calorie_goal", 300)` - æ¯æ—¥ç›®æ ‡

**UI æ›´æ–°**:
```python
def _update_goal_progress(self, current: float, goal: int, percent: int):
    # æ›´æ–°è¿›åº¦æ–‡å­—: "è¿åŠ¨çƒ­é‡ç›®æ ‡ï¼š240/400 åƒå¡ (60%)"
    # æ›´æ–°è¿›åº¦æ¡æ˜¾ç¤º
    # æ‰“å¡å¤©æ•°æš‚ä¸å®ç°
```

---

## æ¨¡å— 2: ä»Šæ—¥æ´»åŠ¨è¯¦æƒ…

**æ•°æ®æ¥æº**:
- `ActivityRepository.get_activities_by_date(date.today())`

**æ˜¾ç¤ºæ ¼å¼**:
```
[ ä»Šå¤© 14:30 ]  ğŸ§ ç«™ç«‹ 2 åˆ†é’Ÿ
[ ä»Šå¤© 11:15 ]  ğŸƒ å¼€åˆè·³ Ã— 3 (2åˆ†é’Ÿ)
[ ä»Šå¤© 09:00 ]  ğŸ‘ï¸ è¿œçœº 1 åˆ†é’Ÿ
```

**å›¾æ ‡æ˜ å°„**:
- `stand` â†’ ğŸ§
- `exercise` â†’ ğŸƒ
- `gaze` â†’ ğŸ‘ï¸

---

## æ¨¡å— 3: å¿«é€Ÿæ“ä½œ

| æŒ‰é’® | æ–¹æ³• | çª—å£ |
|------|------|------|
| ğŸ‹ï¸ åŠ¨ä½œåº“ | `_show_action_library` | æš‚å ä½ |
| âš™ï¸ å‚æ•°è®¾ç½® | `_show_settings` | SettingsDialog |
| ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯ | `_show_user_info` | æš‚å ä½ |
| ğŸ”§ åŸºç¡€è®¾ç½® | `_show_basic_settings` | æš‚å ä½ |

---

## æ–‡ä»¶ä¿®æ”¹

**ä¿®æ”¹**: `src/ui/main_window.py`
- å®ç° `refresh_data()` æ–¹æ³•
- æ·»åŠ  `_update_goal_progress()` æ–¹æ³•
- æ·»åŠ  `_update_activity_list()` æ–¹æ³•
- æ·»åŠ  `_add_activity_item()` æ–¹æ³•
- æ·»åŠ å¿«é€Ÿæ“ä½œæŒ‰é’®è¿æ¥

**æ–°å¢æµ‹è¯•**: `tests/test_main_window_data.py`
- æµ‹è¯•æ•°æ®åŠ è½½
- æµ‹è¯• UI æ›´æ–°
- æµ‹è¯•ç©ºçŠ¶æ€å¤„ç†

---

## å®ç°æ­¥éª¤

1. ä¿®æ”¹ `refresh_data()` å®ç°æ•°æ®è·å–
2. å®ç° `_update_goal_progress()` æ›´æ–°è¿›åº¦æ¨¡å—
3. å®ç° `_update_activity_list()` æ›´æ–°æ´»åŠ¨åˆ—è¡¨
4. æ·»åŠ æ´»åŠ¨é¡¹æ ¼å¼åŒ–æ–¹æ³•
5. è¿æ¥å¿«é€Ÿæ“ä½œæŒ‰é’®ï¼ˆå ä½æ–¹æ³•ï¼‰
6. ç¼–å†™æµ‹è¯•
7. è¿è¡Œæµ‹è¯•éªŒè¯
