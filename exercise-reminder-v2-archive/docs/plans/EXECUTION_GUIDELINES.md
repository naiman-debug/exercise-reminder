# 执行规范 - 首次启动向导项目

> 创建日期：2026-01-26
> 执行角色：全栈开发 + 产品经理 + 测试工程师

---

## 执行原则

### 用户要求
1. **完整交付** - 只展示最终完成版，不在中途打扰
2. **自主决策** - 设计文档未明确的内容，由产品经理角色决定
3. **全面测试** - 所有功能必须经过实际测试验证
4. **只问不确定** - 只有真正不确定的产品决策才询问用户

### 执行流程
```
1. 按照实现计划逐个执行任务
2. 每个任务遵循 TDD: RED → GREEN → REFACTOR
3. 实际运行测试，验证功能
4. 遇到产品设计空白时：
   - 作为产品经理做出合理决策
   - 记录决策到本文档
   - 继续执行
5. 全部完成后，展示最终成果
```

---

## 产品决策记录

本节记录在执行过程中作为产品经理做出的决策。

### 决策 #1: 向导页面顺序
**时间**: 执行开始时
**背景**: PRD 未明确向导页面顺序
**决策**:
1. 欢迎页（产品介绍）
2. 个人信息（数据收集核心）
3. 主题选择（个性化）
4. 音频设置（可选功能）
5. 时间设置（提醒间隔）
**理由**: 从核心到可选，从必需到偏好

### 决策 #2: 向导取消行为
**时间**: Task 8 设计时
**背景**: 用户取消向导时应该如何处理
**决策**: 退出应用，不允许跳过首次设置
**理由**:
- 强制首次设置确保数据完整
- 避免应用在无配置状态下运行
- 符合 PRD "强制" 原则

### 决策 #3: 主题默认选择
**时间**: Task 5 设计时
**背景**: 用户未选择主题时的默认值
**决策**: 默认"日间模式"
**理由**:
- 日间模式最通用
- 符合大多数使用场景（白天工作）

### 决策 #4: 音频默认设置
**时间**: Task 6 设计时
**背景**: 音频功能的默认状态
**决策**:
- 音效：默认启用
- 音量：0.7（70%）
- TTS：默认关闭（需要 API 配置）
**理由**:
- 音效是核心体验，默认开启
- TTS 需要外部 API，默认关闭避免困惑

### 决策 #5: 时间设置默认值
**时间**: Task 7 设计时
**背景**: 提醒间隔的默认值
**决策**:
- 强制站立：30-60 分钟
- 微运动：45-75 分钟
- 强制远眺：60-90 分钟
**理由**:
- 符合 PRD 建议的健康间隔
- 三个功能交错进行，避免冲突

### 决策 #6: 数据验证规则
**时间**: Task 4 设计时
**背景**: 个人信息的合理范围
**决策**:
- 身高：100-250 cm（覆盖绝大多数成人）
- 体重：30-200 kg（覆盖从瘦到胖）
- 年龄：10-100 岁（覆盖从青少年到老人）
- 卡路里目标：100-5000 kcal/天
**理由**:
- 防止输入错误
- 不过度限制合理值

### 决策 #7: 向导窗口样式
**时间**: Task 8 设计时
**背景**: 向导的外观风格
**决策**:
- 使用 ModernStyle
- 最小尺寸：600x500
- 无帮助按钮
- 按钮文本：下一步/上一步/完成设置/退出
**理由**:
- ModernStyle 更现代美观
- 600x500 保证内容显示
- 简化按钮减少困惑

---

## 测试检查清单

### 必须通过的测试

#### 单元测试
- [ ] test_app_imports_qdialog - QDialog 导入修复
- [ ] test_wizard_module_exists - 向导模块可导入
- [ ] test_welcome_page_creation - 欢迎页创建
- [ ] test_profile_page_validation - 个人信息验证
- [ ] test_theme_page_selection - 主题选择
- [ ] test_audio_page_options - 音频选项
- [ ] test_time_settings_defaults - 时间默认值
- [ ] test_wizard_has_all_pages - 向导包含5页
- [ ] test_first_run_flow - 首次运行流程

#### 手动测试
- [ ] 删除数据库，启动应用 → 显示向导
- [ ] 完成向导所有页面 → 应用正常运行
- [ ] 检查数据库 → 配置已保存
- [ ] 再次启动应用 → 不显示向导
- [ ] 取消向导 → 应用退出

### 验证命令
```bash
# 运行所有测试
python -m pytest tests/ -v

# 手动启动测试
rm -f data/app.db && python src/main.py
```

---

## 完成标准

项目被认为完成当且仅当：

1. ✅ 所有单元测试通过 (9/9)
2. ✅ 所有手动测试场景通过
3. ✅ 代码已提交到 git
4. ✅ 数据库正确保存配置
5. ✅ 向导在实际应用中正常工作
6. ✅ 无控制台错误或警告

---

## 执行日志

记录每个任务的执行状态：

- [ ] Task 1: 修复 QDialog 导入
- [ ] Task 2: 创建向导组件结构
- [ ] Task 3: 实现欢迎页面
- [ ] Task 4: 实现个人信息页面
- [ ] Task 5: 实现主题选择页面
- [ ] Task 6: 实现音频设置页面
- [ ] Task 7: 实现时间设置页面
- [ ] Task 8: 组装向导并集成
- [ ] Task 9: 集成测试

---

**最终目标**: 一个完全可用的首次启动向导，用户无需任何修改即可使用。
